<html>
  <head>
    <title>Testing</title>
    <script language="javascript">
      document.addEventListener('DOMContentLoaded', function(){

        var fn = function(u, loaded) {
          const h = new XMLHttpRequest();
          h.onreadystatechange = function() {
            if (h.readyState == 4 && h.status == 200) {
              return loaded(h);
            }
          };
          h.open("GET", u, true);
          h.send()
        };

        fn("../oidc/self", function(t) {
          var j = JSON.parse(t.responseText);
          document.getElementById("mypicture").src = j["picture"];
          var name = j["name"];
          for (v in j["values"]) {
            if (v == "role") {
              for(i in j["values"]["role"]) {
                name = name + " ["+j["values"]["role"][i]+"]";
              }
            }
          }
          document.getElementById("myname").textContent = name;
        });

        fn("../principia/available", function(t) {
          var j = JSON.parse(t.responseText);
          var catalog = document.getElementById("catalog");
          for (item in j) {
            if (j[item].Expose) {
              var node = document.createElement("li");
              var a = document.createElement("a");
              var t = document.createTextNode(item);
              a.href = "../" + item + "/";
              a.innerHtml = item;
              a.appendChild(t);
              node.appendChild(a);
              catalog.appendChild(node);
            } else {
              var node = document.createElement("li");
              var t = document.createTextNode(item);
              node.appendChild(t);
              catalog.appendChild(node);
            }
          }
        });

      });
    </script>
  </head>
  <body>
    <div style="float:clear">
      <hr style="clear:both">
      <span id="myname"></span>
      <img id="mypicture" style="float:right"><img>
      Actions:
      <ul>
        <li><a href="/oidc/login?state=/eWeb/">Google OIDC Login</a>
        <li><a href="/oidc/logout?state=/eWeb/">Logout</a>
        <li><a href="/oidc/self">self</a>
        <li><a href="/oidc/claims">claims</a>
        <li><a href="/principia/available">Services</a>
      </ul>

      <hr>
      Services:
      <ul id=catalog>
      </ul>
    </div>
  </body>
</html>
