<html>
  <head>
    <title>Testing</title>
    <script language="javascript">
      document.addEventListener('DOMContentLoaded', function(){

        var fn = function(u, loaded) {
          const h = new XMLHttpRequest();
          h.onreadystatechange = function() {
            if (h.readyState == 4 && h.status == 200) {
              return loaded(h);
            }
          };
          h.open("GET", u, true);
          h.send()
        };

        fn("../oidc/self", function(t) {
          var j = JSON.parse(t.responseText);
          document.getElementById("mypicture").src = j["picture"];
          var name = j["name"];
          for (v in j["values"]) {
            if (v == "role") {
              for(i in j["values"]["role"]) {
                name = name + " ["+j["values"]["role"][i]+"]";
              }
            }
          }
          document.getElementById("myname").textContent = name;
        });

        fn("../available", function(t) {
          var j = JSON.parse(t.responseText);
          var catalog = document.getElementById("catalog");
          for (item in j) {
            if (j[item].Expose) {
              var node = document.createElement("li");
              var a = document.createElement("a");
              var t = document.createTextNode(item);
              a.href = "../" + item + "/";
              a.innerHtml = item;
              a.appendChild(t);
              node.appendChild(a);
              catalog.appendChild(node);
            }
          }
        });

      });
    </script>
  </head>
  <body>
    <h2 id="myname"></h2>
    <img id="mypicture"><img>
    <hr>
    <ul id=catalog>
  </body>
</html>
